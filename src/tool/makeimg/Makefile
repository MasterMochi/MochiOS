#******************************************************************************#
#* src/tool/makeimg/Makefile                                                  *#
#*                                                                 2019/01/28 *#
#* Copyright (C) 2017-2019 Mochi.                                             *#
#******************************************************************************#
#******************************************************************************#
#* 設定                                                                       *#
#******************************************************************************#
# プログラム名
PROG = makeimg

# ソースコード
SRCS = makeimg.c

# 実行ファイル生成先ディレクトリ
BUILD_DIR = ../../../build

# オブジェクトファイル生成先ディレクトリ
OBJ_DIR = $(BUILD_DIR)/obj/tool/$(PROG)

# Cフラグ
CFLAGS = -m32                   \
         -I$(BUILD_DIR)/include

# LDフラグ
LDFLAGS = -L$(BUILD_DIR)/lib

# LDライブラリフラグ
LDLIBS = -lMLib


#******************************************************************************#
#* マクロ                                                                     *#
#******************************************************************************#
# オブジェクトサブディレクトリ
OBJ_SUBDIRS = $(sort $(addprefix $(OBJ_DIR)/, $(dir $(SRCS))))

# オブジェクトファイル
OBJS = $(addprefix $(OBJ_DIR)/, $(SRCS:.c=.o))

# 依存関係ファイル
DEPS = $(addprefix $(OBJ_DIR)/, $(SRCS:.c=.d))


#******************************************************************************#
#* phonyターゲット                                                            *#
#******************************************************************************#
# コンパイル
.PHONY: all
all: $(OBJ_SUBDIRS) $(BUILD_DIR)/$(PROG) Makefile

# 全生成ファイルの削除
.PHONY: clean
clean:
	-rm -rf $(OBJ_DIR) $(BUILD_DIR)/$(PROG)


#******************************************************************************#
#* 生成規則                                                                   *#
#******************************************************************************#
-include $(DEPS)

# オブジェクトファイル生成先サブディレクトリ
$(OBJ_SUBDIRS):
	mkdir -p $@

# 実行ファイル
$(BUILD_DIR)/$(PROG): $(OBJ_DIR)/$(PROG) Makefile
	ln -sfr $< $@


# コンパイル
$(OBJ_DIR)/$(PROG): $(SRCS) Makefile
	$(CC) $(CFLAGS) -o $@ $(SRCS) -MD -MP $(LDFLAGS) $(LIBS)


#******************************************************************************#
